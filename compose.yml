version: '3.8'

services:
  comfyui:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: comfyui-1080ti
    restart: unless-stopped
    ports:
      - "8188:8188"
    
    # This section is critical for the GTX 1080 Ti to be seen by the container
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

    # Mounts specific folders so your models and outputs persist locally
    volumes:
      # Map your local 'models' folder to the container
      - ./models:/app/models
      # Map your local 'output' folder to save images to your disk
      - ./output:/app/output
      # Map your local 'input' folder for image-to-image workflows
      - ./input:/app/input
      # Optional: Persist custom nodes if you install them via the manager
      - ./custom_nodes:/app/custom_nodes

    # Environment variables to keep the container clean
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - CLI_ARGS=--listen 0.0.0.0 --port 8188 --preview-method auto --cuda-malloc